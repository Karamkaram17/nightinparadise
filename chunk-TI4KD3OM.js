import{a as vt}from"./chunk-HM45AP7J.js";import{a as xt}from"./chunk-7ODROQ6I.js";import{a as Z}from"./chunk-75LTBHHO.js";import{a as K}from"./chunk-US4DBW3U.js";import{a as de}from"./chunk-IXDNPNBC.js";import{f as ht}from"./chunk-AJ34JRYF.js";import{e as ke}from"./chunk-SGK6T4UK.js";import{C as ct,J as pt,O as mt,m as N,p as rt,q as Se,s as p,u as lt,w as dt}from"./chunk-CKGA4VUY.js";import{a as ut,b as pe,c as me,e as ft,g as he}from"./chunk-6RLEIIP6.js";import{b as le,i as ce,p as ot,r as at,s as st}from"./chunk-ZHARXMO6.js";import{G as tt,N as it,a as Ze,ea as nt,k as Je,z as et}from"./chunk-3AY5ZZWG.js";import{c as we,d as Ce,g as W,h as X,j as Ee}from"./chunk-RGNDWIHZ.js";import{a as V,c as gt}from"./chunk-QS2U6FLA.js";import"./chunk-J7C7WOHV.js";import{$b as ae,Aa as je,Ab as d,Ba as He,Bb as Qe,Cb as z,Da as Le,Dc as Y,E as Ue,F as $,Fa as E,Gb as w,Hb as G,Hc as U,Ic as We,Ja as Ve,Jb as Q,Ka as Be,Kb as q,L as x,Lb as a,Mb as s,Nb as c,Pa as xe,Pc as Xe,Rb as qe,Ub as S,Wb as k,X as ue,Xb as _e,Yb as F,Zb as ye,_b as Ye,ac as se,ca as Ne,da as ie,eb as r,ec as g,fa as H,fb as h,fc as Ke,gc as R,h as te,hb as $e,ia as P,lc as A,m as b,ma as _,mb as ze,mc as C,na as ne,nc as L,oa as M,oc as re,pb as Ge,r as Re,rb as ve,sb as T,va as oe,vb as y,wa as ge,xa as fe,ya as Oe,zb as be}from"./chunk-X2WLLBA3.js";var Ut=n=>({showCancel:!0,showSave:!0,title:n}),Nt=()=>({label:"Username"}),Ot=()=>({label:"Name"});function jt(n,t){n&1&&(a(0,"div",7),g(1,"You need to logout and login again to reflect changes"),s())}function Ht(n,t){if(n&1&&(a(0,"div",9),c(1,"kss-lib-checkbox",10),s(),a(2,"div",9),c(3,"kss-lib-checkbox",10),s()),n&2){let l=k();r(),d("label","Admin")("control",l.form.controls.admin),r(2),d("label","Active")("control",l.form.controls.active)}}function Lt(n,t){if(n&1&&(a(0,"div",9),c(1,"kss-lib-checkbox",10),s()),n&2){let l=k();r(),d("label","Reset Password To 00000")("control",l.form.controls.password)}}function Vt(n,t){n&1&&(a(0,"div",9)(1,"h4",11),g(2,"Password: 0000"),s()())}function Bt(n,t){if(n&1&&(a(0,"div",8)(1,"div",12),g(2,"Reservations Permissions"),s(),a(3,"div",9),c(4,"kss-lib-checkbox",10),s(),a(5,"div",9),c(6,"kss-lib-checkbox",10),s(),a(7,"div",9),c(8,"kss-lib-checkbox",10),s(),a(9,"div",12),g(10,"Bungalows Permissions"),s(),a(11,"div",9),c(12,"kss-lib-checkbox",10),s(),a(13,"div",9),c(14,"kss-lib-checkbox",10),s(),a(15,"div",9),c(16,"kss-lib-checkbox",10),s(),a(17,"div",12),g(18,"Customers Permissions"),s(),a(19,"div",9),c(20,"kss-lib-checkbox",10),s(),a(21,"div",12),g(22,"Reports Permissions"),s(),a(23,"div",9),c(24,"kss-lib-checkbox",10),s(),a(25,"div",12),g(26,"Reviews Permissions"),s(),a(27,"div",9),c(28,"kss-lib-checkbox",10),s(),a(29,"div",12),g(30,"Expenses Permissions"),s(),a(31,"div",9),c(32,"kss-lib-checkbox",10),s(),a(33,"div",9),c(34,"kss-lib-checkbox",10),s(),a(35,"div",9),c(36,"kss-lib-checkbox",10),s(),a(37,"div",9),c(38,"kss-lib-checkbox",10),s(),a(39,"div",12),g(40,"Payments Permissions"),s(),a(41,"div",9),c(42,"kss-lib-checkbox",10),s(),a(43,"div",9),c(44,"kss-lib-checkbox",10),s(),a(45,"div",9),c(46,"kss-lib-checkbox",10),s(),a(47,"div",9),c(48,"kss-lib-checkbox",10),s(),a(49,"div",12),g(50,"User Management"),s(),a(51,"div",9),c(52,"kss-lib-checkbox",10),s(),a(53,"div",9),c(54,"kss-lib-checkbox",10),s(),a(55,"div",9),c(56,"kss-lib-checkbox",10),s(),a(57,"div",9),c(58,"kss-lib-checkbox",10),s()()),n&2){let l=k();r(4),d("label","Add Reservations")("control",l.form.controls.permissions.controls.addReservation),r(2),d("label","Modify Reservations")("control",l.form.controls.permissions.controls.editReservation),r(2),d("label","Delete Reservations")("control",l.form.controls.permissions.controls.deleteReservation),r(4),d("label","View Bungalows")("control",l.form.controls.permissions.controls.viewBungalow),r(2),d("label","Add Bungalows")("control",l.form.controls.permissions.controls.addBungalow),r(2),d("label","Modify Bungalows")("control",l.form.controls.permissions.controls.editBungalow),r(4),d("label","View Customers")("control",l.form.controls.permissions.controls.viewCustomers),r(4),d("label","View Reports")("control",l.form.controls.permissions.controls.viewReports),r(4),d("label","View Reviews")("control",l.form.controls.permissions.controls.viewReviews),r(4),d("label","View Expenses")("control",l.form.controls.permissions.controls.viewExpense),r(2),d("label","Add Expenses")("control",l.form.controls.permissions.controls.addExpense),r(2),d("label","Modify Expenses")("control",l.form.controls.permissions.controls.editExpense),r(2),d("label","Delete Expenses")("control",l.form.controls.permissions.controls.deleteExpense),r(4),d("label","View Payments")("control",l.form.controls.permissions.controls.viewRevenue),r(2),d("label","Add Payments")("control",l.form.controls.permissions.controls.addRevenue),r(2),d("label","Modify Payments")("control",l.form.controls.permissions.controls.editRevenue),r(2),d("label","Delete Payments")("control",l.form.controls.permissions.controls.deleteRevenue),r(4),d("label","View Users")("control",l.form.controls.permissions.controls.viewUser),r(2),d("label","Add Users")("control",l.form.controls.permissions.controls.addUser),r(2),d("label","Modify Users")("control",l.form.controls.permissions.controls.editUser),r(2),d("label","View Logs")("control",l.form.controls.permissions.controls.viewLogs)}}var bt=(()=>{let t=class t{constructor(e,i){this.data=e,this._dialogRef=i,this.loggedInUser=le(de.SS.user),this.form=new Se({username:new p("",[N.required,N.minLength(4),N.maxLength(20)]),name:new p("",[N.required,N.minLength(4),N.maxLength(20)]),password:new p(!1),admin:new p(!1),active:new p(!1),passwordRetries:new p(0),permissions:new Se({viewCustomers:new p(!1),viewReviews:new p(!1),viewLogs:new p(!1),viewReports:new p(!1),viewUser:new p(!1),addUser:new p(!1),editUser:new p(!1),deleteUser:new p(!1),viewRevenue:new p(!1),addRevenue:new p(!1),editRevenue:new p(!1),deleteRevenue:new p(!1),viewExpense:new p(!1),addExpense:new p(!1),editExpense:new p(!1),deleteExpense:new p(!1),viewBungalow:new p(!1),addBungalow:new p(!1),editBungalow:new p(!1),deleteBungalow:new p(!1),addReservation:new p(!1),editReservation:new p(!1),deleteReservation:new p(!1)})})}ngOnInit(){this.data&&this._editForm(this.data)}handleDialogActions(e){!e||e==="ok"||e==="cancel"?this._closeDialog():e==="save"&&this._submit()}_closeDialog(e){this._dialogRef.close(e)}_submit(){pt(this.form)&&this._closeDialog(this._format(this.form.value))}_editForm(e){this.form.patchValue({username:e.username,name:e.name,admin:e.admin,active:e.active,passwordRetries:e.passwordRetries,permissions:e.permissions})}_format(e){let i={username:e.username,name:e.name,admin:!!e.admin,active:!!e.active,permissions:e.permissions,passwordRetries:e.active?0:e.passwordRetries};return(e.password||!this.data)&&(i.password="0000"),e.admin&&(i.permissions={}),i}};t.\u0275fac=function(i){return new(i||t)(h(me),h(pe))},t.\u0275cmp=_({type:t,selectors:[["ks-solutions-user-popup"]],standalone:!0,features:[C],decls:15,vars:16,consts:[[3,"btnClicked","config"],[1,"px-2",3,"ngSubmit","formGroup"],[1,"container-fluid","text-start"],[1,"row","mt-3"],[1,"col-12","col-lg-6"],[3,"config","readonly","noSpace","control"],[3,"config","control"],[1,"text-center","h4"],[1,"row"],[1,"col-12","col-md-6","col-lg-4"],[3,"label","control"],[1,"mt-2","ps-3"],[1,"col-12","h4","mt-4","mb-0"]],template:function(i,o){i&1&&(a(0,"kss-lib-confirm-body",0),S("btnClicked",function(u){return o.handleDialogActions(u)}),a(1,"div")(2,"form",1),S("ngSubmit",function(){return o.handleDialogActions("save")}),a(3,"div",2)(4,"div",3)(5,"div",4),c(6,"kss-lib-input",5),s(),a(7,"div",4),c(8,"kss-lib-input",6),s()(),y(9,jt,2,0,"div",7),a(10,"div",8),y(11,Ht,4,4)(12,Lt,2,2,"div",9)(13,Vt,3,0,"div",9),s(),y(14,Bt,59,42,"div",8),s()()()()),i&2&&(d("config",re(12,Ut,o.data?"Edit User":"Create New User")),r(2),d("formGroup",o.form),r(4),d("config",L(14,Nt))("readonly",!!o.data)("noSpace",!0)("control",o.form.controls.username),r(2),d("config",L(15,Ot))("control",o.form.controls.name),r(),w(o.data&&o.form.value.username===(o.loggedInUser==null?null:o.loggedInUser.username)?9:-1),r(2),w(o.form.value.username!==(o.loggedInUser==null?null:o.loggedInUser.username)?11:-1),r(),w(o.data&&o.form.value.username!==(o.loggedInUser==null?null:o.loggedInUser.username)?12:o.data?-1:13),r(2),w(o.form.value.admin?-1:14))},dependencies:[he,mt,xt,ct,lt,rt,dt],styles:[".cd-max[_ngcontent-%COMP%]{max-height:calc(95dvh - 180px);overflow-y:auto}"],changeDetection:0});let n=t;return n})();var Ae=(()=>{let t=class t{constructor(){this._networkService=P(gt),this._users$=new b,this.users$=this._users$.asObservable()}getAllUsers(){this._networkService.get(V.USERS.users).subscribe({next:e=>{this._users$.next(e.data?e.data:[])}})}addNewUser(e){this._networkService.post(V.USERS.users,e).pipe(x(1)).subscribe({next:()=>{this.getAllUsers()}})}getLogs(e){return this._networkService.get(V.USERS.tracking,e.username)}editUser(e){this._networkService.patch(V.USERS.users,e,e.username).pipe(x(1)).subscribe({next:()=>{this.getAllUsers()}})}deleteUser(e){this._networkService.delete(V.USERS.users,e.username).pipe(x(1)).subscribe({next:()=>{this.getAllUsers()}})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ne({token:t,factory:t.\u0275fac});let n=t;return n})();var zt=0,De=new H("CdkAccordion"),_t=(()=>{let t=class t{constructor(){this._stateChanges=new b,this._openCloseAllActions=new b,this.id=`cdk-accordion-${zt++}`,this.multi=!1}openAll(){this.multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(e){this._stateChanges.next(e)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}};t.\u0275fac=function(i){return new(i||t)},t.\u0275dir=M({type:t,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:[2,"multi","multi",U]},exportAs:["cdkAccordion"],standalone:!0,features:[A([{provide:De,useExisting:t}]),T,oe]});let n=t;return n})(),Gt=0,yt=(()=>{let t=class t{get expanded(){return this._expanded}set expanded(e){if(this._expanded!==e){if(this._expanded=e,this.expandedChange.emit(e),e){this.opened.emit();let i=this.accordion?this.accordion.id:this.id;this._expansionDispatcher.notify(this.id,i)}else this.closed.emit();this._changeDetectorRef.markForCheck()}}constructor(e,i,o){this.accordion=e,this._changeDetectorRef=i,this._expansionDispatcher=o,this._openCloseAllSubscription=te.EMPTY,this.closed=new E,this.opened=new E,this.destroyed=new E,this.expandedChange=new E,this.id=`cdk-accordion-child-${Gt++}`,this._expanded=!1,this.disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=o.listen((m,u)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===u&&this.id!==m&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(e=>{this.disabled||(this.expanded=e)})}};t.\u0275fac=function(i){return new(i||t)(h(De,12),h(Y),h(ce))},t.\u0275dir=M({type:t,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:[2,"expanded","expanded",U],disabled:[2,"disabled","disabled",U]},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],standalone:!0,features:[A([{provide:De,useValue:void 0}]),T]});let n=t;return n})(),wt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=ne({type:t}),t.\u0275inj=ie({});let n=t;return n})();var Yt=["body"],Kt=[[["mat-expansion-panel-header"]],"*",[["mat-action-row"]]],Wt=["mat-expansion-panel-header","*","mat-action-row"];function Xt(n,t){}var Zt=[[["mat-panel-title"]],[["mat-panel-description"]],"*"],Jt=["mat-panel-title","mat-panel-description","*"];function ei(n,t){if(n&1&&(a(0,"span",1),Oe(),a(1,"svg",2),c(2,"path",3),s()()),n&2){let l=k();d("@indicatorRotate",l._getExpandedState())}}var Ie=new H("MAT_ACCORDION"),Ct="225ms cubic-bezier(0.4,0.0,0.2,1)",St={indicatorRotate:we("indicatorRotate",[X("collapsed, void",W({transform:"rotate(0deg)"})),X("expanded",W({transform:"rotate(180deg)"})),Ee("expanded <=> collapsed, void => collapsed",Ce(Ct))]),bodyExpansion:we("bodyExpansion",[X("collapsed, void",W({height:"0px",visibility:"hidden"})),X("expanded",W({height:"*",visibility:""})),Ee("expanded <=> collapsed, void => collapsed",Ce(Ct))])},kt=new H("MAT_EXPANSION_PANEL"),ti=(()=>{let t=class t{constructor(e,i){this._template=e,this._expansionPanel=i}};t.\u0275fac=function(i){return new(i||t)(h($e),h(kt,8))},t.\u0275dir=M({type:t,selectors:[["ng-template","matExpansionPanelContent",""]],standalone:!0});let n=t;return n})(),ii=0,At=new H("MAT_EXPANSION_PANEL_DEFAULT_OPTIONS"),Pe=(()=>{let t=class t extends yt{get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(e){this._hideToggle=e}get togglePosition(){return this._togglePosition||this.accordion&&this.accordion.togglePosition}set togglePosition(e){this._togglePosition=e}constructor(e,i,o,m,u,f,D){super(e,i,o),this._viewContainerRef=m,this._animationMode=f,this._hideToggle=!1,this.afterExpand=new E,this.afterCollapse=new E,this._inputChanges=new b,this._headerId=`mat-expansion-panel-header-${ii++}`,this.accordion=e,this._document=u,this._animationsDisabled=f==="NoopAnimations",D&&(this.hideToggle=D.hideToggle)}_hasSpacing(){return this.accordion?this.expanded&&this.accordion.displayMode==="default":!1}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(ue(null),$(()=>this.expanded&&!this._portal),x(1)).subscribe(()=>{this._portal=new ot(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(e){this._inputChanges.next(e)}ngOnDestroy(){super.ngOnDestroy(),this._inputChanges.complete()}_containsFocus(){if(this._body){let e=this._document.activeElement,i=this._body.nativeElement;return e===i||i.contains(e)}return!1}_animationStarted(e){!Et(e)&&!this._animationsDisabled&&this._body&&this._body?.nativeElement.setAttribute("inert","")}_animationDone(e){Et(e)||(e.toState==="expanded"?this.afterExpand.emit():e.toState==="collapsed"&&this.afterCollapse.emit(),!this._animationsDisabled&&this._body&&this._body.nativeElement.removeAttribute("inert"))}};t.\u0275fac=function(i){return new(i||t)(h(Ie,12),h(Y),h(ce),h(ze),h(Xe),h(xe,8),h(At,8))},t.\u0275cmp=_({type:t,selectors:[["mat-expansion-panel"]],contentQueries:function(i,o,m){if(i&1&&ye(m,ti,5),i&2){let u;ae(u=se())&&(o._lazyContent=u.first)}},viewQuery:function(i,o){if(i&1&&Ye(Yt,5),i&2){let m;ae(m=se())&&(o._body=m.first)}},hostAttrs:[1,"mat-expansion-panel"],hostVars:6,hostBindings:function(i,o){i&2&&z("mat-expanded",o.expanded)("_mat-animation-noopable",o._animationsDisabled)("mat-expansion-panel-spacing",o._hasSpacing())},inputs:{hideToggle:[2,"hideToggle","hideToggle",U],togglePosition:"togglePosition"},outputs:{afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["matExpansionPanel"],standalone:!0,features:[A([{provide:Ie,useValue:void 0},{provide:kt,useExisting:t}]),T,ve,oe,C],ngContentSelectors:Wt,decls:7,vars:4,consts:[["body",""],["role","region",1,"mat-expansion-panel-content",3,"id"],[1,"mat-expansion-panel-body"],[3,"cdkPortalOutlet"]],template:function(i,o){if(i&1){let m=qe();_e(Kt),F(0),a(1,"div",1,0),S("@bodyExpansion.start",function(f){return ge(m),fe(o._animationStarted(f))})("@bodyExpansion.done",function(f){return ge(m),fe(o._animationDone(f))}),a(3,"div",2),F(4,1),y(5,Xt,0,0,"ng-template",3),s(),F(6,2),s()}i&2&&(r(),d("@bodyExpansion",o._getExpandedState())("id",o.id),be("aria-labelledby",o._headerId),r(4),d("cdkPortalOutlet",o._portal))},dependencies:[at],styles:['.mat-expansion-panel{box-sizing:content-box;display:block;margin:0;overflow:hidden;transition:margin 225ms cubic-bezier(0.4, 0, 0.2, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);position:relative;background:var(--mat-expansion-container-background-color, var(--mat-app-surface));color:var(--mat-expansion-container-text-color, var(--mat-app-on-surface));border-radius:var(--mat-expansion-container-shape)}.mat-expansion-panel:not([class*=mat-elevation-z]){box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)}.mat-accordion .mat-expansion-panel:not(.mat-expanded),.mat-accordion .mat-expansion-panel:not(.mat-expansion-panel-spacing){border-radius:0}.mat-accordion .mat-expansion-panel:first-of-type{border-top-right-radius:var(--mat-expansion-container-shape);border-top-left-radius:var(--mat-expansion-container-shape)}.mat-accordion .mat-expansion-panel:last-of-type{border-bottom-right-radius:var(--mat-expansion-container-shape);border-bottom-left-radius:var(--mat-expansion-container-shape)}.cdk-high-contrast-active .mat-expansion-panel{outline:solid 1px}.mat-expansion-panel.ng-animate-disabled,.ng-animate-disabled .mat-expansion-panel,.mat-expansion-panel._mat-animation-noopable{transition:none}.mat-expansion-panel-content{display:flex;flex-direction:column;overflow:visible;font-family:var(--mat-expansion-container-text-font, var(--mat-app-body-large-font));font-size:var(--mat-expansion-container-text-size, var(--mat-app-body-large-size));font-weight:var(--mat-expansion-container-text-weight, var(--mat-app-body-large-weight));line-height:var(--mat-expansion-container-text-line-height, var(--mat-app-body-large-line-height));letter-spacing:var(--mat-expansion-container-text-tracking, var(--mat-app-body-large-tracking))}.mat-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.mat-expansion-panel-body{padding:0 24px 16px}.mat-expansion-panel-spacing{margin:16px 0}.mat-accordion>.mat-expansion-panel-spacing:first-child,.mat-accordion>*:first-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-top:0}.mat-accordion>.mat-expansion-panel-spacing:last-child,.mat-accordion>*:last-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-bottom:0}.mat-action-row{border-top-style:solid;border-top-width:1px;display:flex;flex-direction:row;justify-content:flex-end;padding:16px 8px 16px 24px;border-top-color:var(--mat-expansion-actions-divider-color, var(--mat-app-outline))}.mat-action-row .mat-button-base,.mat-action-row .mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-action-row .mat-button-base,[dir=rtl] .mat-action-row .mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2,data:{animation:[St.bodyExpansion]},changeDetection:0});let n=t;return n})();function Et(n){return n.fromState==="void"}var Me=(()=>{let t=class t{constructor(e,i,o,m,u,f,D){this.panel=e,this._element=i,this._focusMonitor=o,this._changeDetectorRef=m,this._animationMode=f,this._parentChangeSubscription=te.EMPTY,this.tabIndex=0;let I=e.accordion?e.accordion._stateChanges.pipe($(v=>!!(v.hideToggle||v.togglePosition))):Re;this.tabIndex=parseInt(D||"")||0,this._parentChangeSubscription=Ue(e.opened,e.closed,I,e._inputChanges.pipe($(v=>!!(v.hideToggle||v.disabled||v.togglePosition)))).subscribe(()=>this._changeDetectorRef.markForCheck()),e.closed.pipe($(()=>e._containsFocus())).subscribe(()=>o.focusVia(i,"program")),u&&(this.expandedHeight=u.expandedHeight,this.collapsedHeight=u.collapsedHeight)}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_getTogglePosition(){return this.panel.togglePosition}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_getHeaderHeight(){let e=this._isExpanded();return e&&this.expandedHeight?this.expandedHeight:!e&&this.collapsedHeight?this.collapsedHeight:null}_keydown(e){switch(e.keyCode){case 32:case 13:Je(e)||(e.preventDefault(),this._toggle());break;default:this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(e);return}}focus(e,i){e?this._focusMonitor.focusVia(this._element,e,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(e=>{e&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}};t.\u0275fac=function(i){return new(i||t)(h(Pe,1),h(Ve),h(tt),h(Y),h(At,8),h(xe,8),He("tabindex"))},t.\u0275cmp=_({type:t,selectors:[["mat-expansion-panel-header"]],hostAttrs:["role","button",1,"mat-expansion-panel-header","mat-focus-indicator"],hostVars:15,hostBindings:function(i,o){i&1&&S("click",function(){return o._toggle()})("keydown",function(u){return o._keydown(u)}),i&2&&(be("id",o.panel._headerId)("tabindex",o.disabled?-1:o.tabIndex)("aria-controls",o._getPanelId())("aria-expanded",o._isExpanded())("aria-disabled",o.panel.disabled),Qe("height",o._getHeaderHeight()),z("mat-expanded",o._isExpanded())("mat-expansion-toggle-indicator-after",o._getTogglePosition()==="after")("mat-expansion-toggle-indicator-before",o._getTogglePosition()==="before")("_mat-animation-noopable",o._animationMode==="NoopAnimations"))},inputs:{expandedHeight:"expandedHeight",collapsedHeight:"collapsedHeight",tabIndex:[2,"tabIndex","tabIndex",e=>e==null?0:We(e)]},standalone:!0,features:[T,C],ngContentSelectors:Jt,decls:5,vars:3,consts:[[1,"mat-content"],[1,"mat-expansion-indicator"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960","aria-hidden","true","focusable","false"],["d","M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z"]],template:function(i,o){i&1&&(_e(Zt),a(0,"span",0),F(1),F(2,1),F(3,2),s(),y(4,ei,3,1,"span",1)),i&2&&(z("mat-content-hide-toggle",!o._showToggle()),r(4),w(o._showToggle()?4:-1))},styles:['.mat-expansion-panel-header{display:flex;flex-direction:row;align-items:center;padding:0 24px;border-radius:inherit;transition:height 225ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-expansion-header-collapsed-state-height);font-family:var(--mat-expansion-header-text-font, var(--mat-app-title-medium-font));font-size:var(--mat-expansion-header-text-size, var(--mat-app-title-medium-size));font-weight:var(--mat-expansion-header-text-weight, var(--mat-app-title-medium-weight));line-height:var(--mat-expansion-header-text-line-height, var(--mat-app-title-medium-line-height));letter-spacing:var(--mat-expansion-header-text-tracking, var(--mat-app-title-medium-tracking))}.mat-expansion-panel-header.mat-expanded{height:var(--mat-expansion-header-expanded-state-height)}.mat-expansion-panel-header[aria-disabled=true]{color:var(--mat-expansion-header-disabled-state-text-color)}.mat-expansion-panel-header:not([aria-disabled=true]){cursor:pointer}.mat-expansion-panel:not(.mat-expanded) .mat-expansion-panel-header:not([aria-disabled=true]):hover{background:var(--mat-expansion-header-hover-state-layer-color)}@media(hover: none){.mat-expansion-panel:not(.mat-expanded) .mat-expansion-panel-header:not([aria-disabled=true]):hover{background:var(--mat-expansion-container-background-color, var(--mat-app-surface))}}.mat-expansion-panel .mat-expansion-panel-header:not([aria-disabled=true]).cdk-keyboard-focused,.mat-expansion-panel .mat-expansion-panel-header:not([aria-disabled=true]).cdk-program-focused{background:var(--mat-expansion-header-focus-state-layer-color)}.mat-expansion-panel-header._mat-animation-noopable{transition:none}.mat-expansion-panel-header:focus,.mat-expansion-panel-header:hover{outline:none}.mat-expansion-panel-header.mat-expanded:focus,.mat-expansion-panel-header.mat-expanded:hover{background:inherit}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before{flex-direction:row-reverse}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 16px 0 0}[dir=rtl] .mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 0 0 16px}.mat-content{display:flex;flex:1;flex-direction:row;overflow:hidden}.mat-content.mat-content-hide-toggle{margin-right:8px}[dir=rtl] .mat-content.mat-content-hide-toggle{margin-right:0;margin-left:8px}.mat-expansion-toggle-indicator-before .mat-content.mat-content-hide-toggle{margin-left:24px;margin-right:0}[dir=rtl] .mat-expansion-toggle-indicator-before .mat-content.mat-content-hide-toggle{margin-right:24px;margin-left:0}.mat-expansion-panel-header-title{color:var(--mat-expansion-header-text-color, var(--mat-app-on-surface))}.mat-expansion-panel-header-title,.mat-expansion-panel-header-description{display:flex;flex-grow:1;flex-basis:0;margin-right:16px;align-items:center}[dir=rtl] .mat-expansion-panel-header-title,[dir=rtl] .mat-expansion-panel-header-description{margin-right:0;margin-left:16px}.mat-expansion-panel-header[aria-disabled=true] .mat-expansion-panel-header-title,.mat-expansion-panel-header[aria-disabled=true] .mat-expansion-panel-header-description{color:inherit}.mat-expansion-panel-header-description{flex-grow:2;color:var(--mat-expansion-header-description-color, var(--mat-app-on-surface-variant))}.mat-expansion-indicator::after{border-style:solid;border-width:0 2px 2px 0;content:"";display:inline-block;padding:3px;transform:rotate(45deg);vertical-align:middle;color:var(--mat-expansion-header-indicator-color, var(--mat-app-on-surface-variant));display:var(--mat-expansion-legacy-header-indicator-display, inline-block)}.mat-expansion-indicator svg{width:24px;height:24px;margin:0 -8px;vertical-align:middle;fill:var(--mat-expansion-header-indicator-color, var(--mat-app-on-surface-variant));display:var(--mat-expansion-header-indicator-display, none)}.cdk-high-contrast-active .mat-expansion-panel-content{border-top:1px solid;border-top-left-radius:0;border-top-right-radius:0}'],encapsulation:2,data:{animation:[St.indicatorRotate]},changeDetection:0});let n=t;return n})();var Dt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275dir=M({type:t,selectors:[["mat-panel-title"]],hostAttrs:[1,"mat-expansion-panel-header-title"],standalone:!0});let n=t;return n})(),It=(()=>{let t=class t extends _t{constructor(){super(...arguments),this._ownHeaders=new Be,this.hideToggle=!1,this.displayMode="default",this.togglePosition="after"}ngAfterContentInit(){this._headers.changes.pipe(ue(this._headers)).subscribe(e=>{this._ownHeaders.reset(e.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new et(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(e){this._keyManager.onKeydown(e)}_handleHeaderFocus(e){this._keyManager.updateActiveItem(e)}ngOnDestroy(){super.ngOnDestroy(),this._keyManager?.destroy(),this._ownHeaders.destroy()}};t.\u0275fac=(()=>{let e;return function(o){return(e||(e=je(t)))(o||t)}})(),t.\u0275dir=M({type:t,selectors:[["mat-accordion"]],contentQueries:function(i,o,m){if(i&1&&ye(m,Me,5),i&2){let u;ae(u=se())&&(o._headers=u)}},hostAttrs:[1,"mat-accordion"],hostVars:2,hostBindings:function(i,o){i&2&&z("mat-accordion-multi",o.multi)},inputs:{hideToggle:[2,"hideToggle","hideToggle",U],displayMode:"displayMode",togglePosition:"togglePosition"},exportAs:["matAccordion"],standalone:!0,features:[A([{provide:Ie,useExisting:t}]),T,ve]});let n=t;return n})(),Pt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=ne({type:t}),t.\u0275inj=ie({imports:[it,wt,st]});let n=t;return n})();var oi=n=>({showOk:!0,title:n}),ai=()=>({icon:"calendar",extraClass:"me-3"}),si=()=>({icon:"clock",extraClass:"me-3"});function ri(n,t){if(n&1&&(a(0,"div",7),c(1,"kss-lib-icon",5),a(2,"span",8),g(3),s()()),n&2){let l=t.$implicit;r(),d("config",L(2,si)),r(2),Ke(l)}}function li(n,t){if(n&1&&(a(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),c(3,"kss-lib-icon",5),g(4),a(5,"span",4),g(6),s()()(),a(7,"div",6),Q(8,ri,4,3,"div",7,G),s()()),n&2){let l=t.$implicit;r(3),d("config",L(3,ai)),r(),R(" ",l.day," "),r(2),R("(",l.time.length,")"),r(2),q(l.time)}}function di(n,t){if(n&1&&(a(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),g(3),a(4,"span",4),g(5),s()()(),Q(6,li,10,4,"mat-expansion-panel",null,G),s()),n&2){let l=t.$implicit;r(3),R(" ",l.month," "),r(2),R("(",l.monthCount,")"),r(),q(l.days)}}function ci(n,t){if(n&1&&(a(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),g(3),a(4,"span",4),g(5),s()()(),Q(6,di,8,2,"mat-expansion-panel",null,G),s()),n&2){let l=t.$implicit;r(3),R(" ",l.year," "),r(2),R("(",l.yearCount,")"),r(),q(l.months)}}var Mt=(()=>{let t=class t{constructor(e,i){this.data=e,this._dialogRef=i,this.dates=[]}ngOnInit(){this.dates=this.convertDates(this.data.dates)}handleDialogActions(e){(!e||e==="ok"||e==="cancel")&&this.closeDialog()}convertDates(e){let i=[];return e.forEach(o=>{let m=new Date(o),u=`${m.getFullYear()}`,f=m.toLocaleString("default",{month:"long"}),D=`${m.toLocaleString("default",{weekday:"long"})} ${m.getDate()}`,I=m.getHours(),v=m.getMinutes(),Fe=m.getSeconds(),Tt=I>=12?"PM":"AM";I=I%12||12;let Ft=`${(I<10?"0":"")+I}:${(v<10?"0":"")+v}:${(Fe<10?"0":"")+Fe} ${Tt}`,O=i.find(B=>B.year===u);O||(O={year:u,yearCount:0,months:[]},i.push(O));let j=O.months.find(B=>B.month===f);j||(j={month:f,monthCount:0,days:[]},O.months.push(j));let ee=j.days.find(B=>B.day===D);ee||(ee={day:D,time:[]},j.days.push(ee)),ee.time.push(Ft),j.monthCount++,O.yearCount++}),i}closeDialog(){this._dialogRef.close()}};t.\u0275fac=function(i){return new(i||t)(h(me),h(pe))},t.\u0275cmp=_({type:t,selectors:[["ks-solutions-logs-popup"]],standalone:!0,features:[C],decls:6,vars:3,consts:[[3,"btnClicked","config"],[1,"container","py-2","cd-max"],[1,"row","justify-content-center","my-auto"],[1,"example-headers-align"],[1,"ms-auto"],[3,"config"],[1,"px-5"],[1,"d-flex","align-items-center","gap-2"],[1,"text-break"]],template:function(i,o){i&1&&(a(0,"kss-lib-confirm-body",0),S("btnClicked",function(){return o.handleDialogActions()}),a(1,"div",1)(2,"div",2)(3,"mat-accordion",3),Q(4,ci,8,2,"mat-expansion-panel",null,G),s()()()()),i&2&&(d("config",re(1,oi,o.data.user.username+" Logins")),r(4),q(o.dates))},dependencies:[he,Pt,It,Pe,Me,Dt,nt],styles:[".cd-max[_ngcontent-%COMP%]{max-height:calc(90dvh - 150px);overflow-y:auto}@media (max-width: 600px){[_nghost-%COMP%]     .mat-expansion-panel-body{padding:0!important}}"],changeDetection:0});let n=t;return n})();function pi(n,t){if(n&1&&c(0,"kss-lib-table",0),n&2){let l=k();d("config",l.gridConfig)("refresh$",l.refresh$)}}var Te=function(n){return n.new="Add User",n}(Te||{}),Rn=(()=>{let t=class t{constructor(){this._dialog=P(ft),this._destroyRef=P(Le),this._userService=P(Ae),this._navService=P(ut),this.refresh$=new b,this._canAdd=Z(K.ADD_USER),this._canEdit=Z(K.EDIT_USER),this._isAdmin=Z(K.ADMIN),this._canViewLogs=Z(K.VIEW_LOGS),this._loggedInUser=le(de.SS.user)}ngOnInit(){this._navService.updateNav({show:!0,back:!1,title:Ze.LAYOUT.children.USER_MANAGEMENT.name,buttons:[{label:Te.new,prefixIcon:{icon:"plus_circle",extraClass:"me-1"},hide:!this._canAdd}]}),this._navService.buttonClicked$.pipe(ke(this._destroyRef)).subscribe(e=>{e===Te.new&&this._openUserPopup()}),this._userService.getAllUsers(),this._initializeGrid(),this._userService.users$.pipe(ke(this._destroyRef)).subscribe(e=>{this.refresh$.next({data:e})})}_initializeGrid(){this.gridConfig={data:Ge([]),defaultPagination:100,maxTableHeight:"calc(100dvh - 115px - 50px - 50px - 80px)",noDataMessage:"No Users Found",elevation:8,features:{showSearch:!0},columns:[{field:"username",title:"Username",type:"string",readonlyFn:()=>!0,position:"p-start"},{field:"name",title:"Name",type:"string",readonlyFn:()=>!0,position:"p-start"},{field:"admin",title:"Admin",type:"chip",extraStyles:{width:"120px"},readonlyFn:()=>!0,position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.admin===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"},{field:"active",title:"Active",type:"chip",extraStyles:{width:"120px"},readonlyFn:()=>!0,position:"p-start",truthy:{false:"No",true:"Yes"},setChipClass:e=>e.active===!0?"rounded rounded-5 px-3 py-1 text-bg-success cs-w-120":"rounded rounded-5 px-3 py-1 text-bg-danger cs-w-120"}],actionsColumn:{enabled:this._canEdit||this._canViewLogs||this._isAdmin,buttons:[]}},this._canViewLogs&&this.gridConfig.actionsColumn?.buttons?.push({icon:{icon:"clock"},label:"View Logins",onClickFn:e=>this._openLogsPopup(e),isVisibleFn:e=>this._canViewLogs}),this._canEdit&&this.gridConfig.actionsColumn?.buttons?.push({icon:{icon:"edit"},label:"Edit",onClickFn:e=>this._openUserPopup(e),isVisibleFn:e=>this._canEdit}),this._isAdmin&&this.gridConfig.actionsColumn?.buttons?.push({icon:{icon:"delete",extraClass:"text-danger"},label:"Delete",onClickFn:e=>this._deleteUser(e),isVisibleFn:e=>!!(e.username!==this._loggedInUser.username&&this._isAdmin)})}_openUserPopup(e){this._dialog.open(bt,{width:"95vw",maxWidth:"1000px",maxHeight:"95vh",disableClose:!0,autoFocus:!1,restoreFocus:!0,data:e}).afterClosed().pipe(x(1)).subscribe(i=>{i&&e?this._userService.editUser(i):i&&!e&&this._userService.addNewUser(i)})}_openLogsPopup(e){this._userService.getLogs(e).pipe(x(1)).subscribe(i=>{i&&i.data&&this._dialog.open(Mt,{width:"95vw",maxWidth:"500px",maxHeight:"95vh",disableClose:!0,autoFocus:!1,restoreFocus:!0,data:{user:e,dates:i.data.map(o=>o.date)}})})}_deleteUser(e){let i={title:"Confirm Delete",bodyMessage:"Are you sure you want to delete this user?",showYesNo:!0,showOk:!1,state:"error"};this._dialog.open(vt,{width:"95vw",maxWidth:"500px",disableClose:!0,restoreFocus:!0,autoFocus:!1,data:i}).afterClosed().pipe(x(1)).subscribe(o=>{o&&o==="yes"&&e&&e.username&&this._userService.deleteUser(e)})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=_({type:t,selectors:[["ks-solutions-users-listing"]],standalone:!0,features:[A([Ae]),C],decls:1,vars:1,consts:[[3,"config","refresh$"]],template:function(i,o){i&1&&y(0,pi,1,2,"kss-lib-table",0),i&2&&w(o.gridConfig?0:-1)},dependencies:[ht],changeDetection:0});let n=t;return n})();export{Rn as UsersComponent};
