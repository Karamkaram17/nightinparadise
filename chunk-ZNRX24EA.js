import{a as s}from"./chunk-IXDNPNBC.js";import{a as o,b as T}from"./chunk-ZHARXMO6.js";import{a as h}from"./chunk-3AY5ZZWG.js";import{a,c as S}from"./chunk-QS2U6FLA.js";import{n as m}from"./chunk-J7C7WOHV.js";import{L as l,ca as c,ha as f,m as u,pb as g}from"./chunk-X2WLLBA3.js";var A=(()=>{let i=class i{constructor(t,e){this._networkService=t,this._router=e,this.isRefreshTokenCalled=!1,this.isLoggingIn=g(!1),this.isLogoutCalled=!1,this.refreshToken$=new u}login(t,e){this.isLoggingIn.set(!0),this._networkService.post(a.AUTHENTICATION.login,{username:t,password:e}).pipe(l(1)).subscribe({next:r=>{r&&r.data&&(this.isLogoutCalled=!1,this.isRefreshTokenCalled=!1,o(s.SS.token,r.data.accessToken),o(s.SS.username,r.data.username),o(s.SS.name,r.data.name),o(s.SS.user,JSON.stringify(r.data)),this._router.navigateByUrl(h.LAYOUT.route)),this.isLoggingIn.set(!1)},error:()=>{this.isLoggingIn.set(!1)}})}logOut(t){let e=T(s.SS.username);!this.isLogoutCalled&&this._networkService.post(a.AUTHENTICATION.logout,{isFromInterceptor:t,username:e}).pipe(l(1)).subscribe(),sessionStorage.clear(),this._router.navigateByUrl(h.LOGIN.route),this.refreshToken$.next(null),this.isLogoutCalled=!0}callRefreshToken(){return this._networkService.post(a.AUTHENTICATION.refresh,{})}successfulRefreshToken(t){let e=t.data?.accessToken;e?(o(s.SS.token,e),this.isRefreshTokenCalled=!1,this.refreshToken$.next(e)):this.logOut(!0)}};i.\u0275fac=function(e){return new(e||i)(f(S),f(m))},i.\u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();export{A as a};
